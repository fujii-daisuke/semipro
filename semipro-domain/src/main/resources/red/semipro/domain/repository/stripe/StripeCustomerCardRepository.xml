<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="red.semipro.domain.repository.stripe.StripeCustomerCardRepository">

    <resultMap id="stripeCustomerCard" type="red.semipro.domain.model.stripe.StripeCustomerCard">
        <result property="id" column="id"/>
        <result property="stripeCustomerId" column="stripe_customer_id"/>
        <result property="cardId" column="card_id"/>
    </resultMap>

    <select id="findAll" resultMap="stripeCustomerCard">
        SELECT
            id
            , stripe_customer_id
            , card_id
        FROM stripe_customer_card
        WHERE
        stripe_customer_id = #{stripeCustomerId}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO stripe_customer_card (
            stripe_customer_id
            , card_id
        ) VALUES (
            #{stripeCustomerId}
            , #{cardId}
        )
    </insert>

    <select id="hasCard" resultType="_boolean">
        SELECT
            COUNT(stripe_customer_card.card_id) > 0
        FROM account_stripe_customer
        INNER JOIN stripe_customer_card ON account_stripe_customer.stripe_customer_id = stripe_customer_card.stripe_customer_id
        WHERE
        account_stripe_customer.account_id = #{accountId}
        AND stripe_customer_card.card_id = #{cardId}
    </select>

</mapper>